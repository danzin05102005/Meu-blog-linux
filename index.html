<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linux Lab</title>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

    <style>
        /* --- CORE CONFIG --- */
        :root { 
            --bg: #050505; 
            --panel: rgba(17, 17, 17, 0.95); 
            --text: #eee; 
            --border: #333;
            /* DEFAULT (VERDE) */
            --matrix-color: #00ff41; 
            --accent-color: #9d00ff; 
        }

        /* TEMAS */
        body.theme-cyber { --matrix-color: #fcee0a; --accent-color: #00f0ff; }
        body.theme-frost { --matrix-color: #ffffff; --accent-color: #0066ff; }
        body.theme-crimson { --matrix-color: #ff003c; --accent-color: #ffcc00; }
        body.theme-amethyst { --matrix-color: #d300ff; --accent-color: #00ffea; }
        body.theme-solar { --matrix-color: #ffaa00; --accent-color: #ff5500; }

        body { background-color: var(--bg); color: var(--text); font-family: 'Courier New', monospace; margin: 0; padding-bottom: 80px; overflow-x: hidden; transition: 0.3s; cursor: crosshair; }
        
        button, a, .card, input, textarea, label { cursor: alias; }
        canvas#matrix { position: fixed; top: 0; left: 0; z-index: -1; width: 100%; height: 100%; }

        /* HEADER */
        header { text-align: center; padding: 20px; border-bottom: 2px solid var(--matrix-color); background: var(--panel); backdrop-filter: blur(5px); position: relative; z-index: 10; transition: 0.3s; }
        h1 { margin: 0; color: var(--matrix-color); text-transform: uppercase; letter-spacing: 2px; display: inline-block; }
        h1:hover { animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite; color: var(--accent-color); }
        @keyframes glitch { 0% { transform: translate(0) } 20% { transform: translate(-2px, 2px) } 40% { transform: translate(-2px, -2px) } 60% { transform: translate(2px, 2px) } 80% { transform: translate(2px, -2px) } 100% { transform: translate(0) } }

        #relogio { font-size: 2.5rem; font-weight: bold; text-shadow: 0 0 10px var(--matrix-color); margin: 10px 0; color: var(--text); }
        #btn-terminal { background: transparent; border: none; color: var(--matrix-color); font-size: 1.5rem; cursor: pointer; position: absolute; top: 20px; right: 20px; font-weight: bold; animation: piscar 2s infinite; }
        
        .nav-bar { margin-top: 15px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .nav-btn { background: transparent; border: 1px solid var(--matrix-color); color: var(--matrix-color); padding: 8px 16px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.3s; text-decoration: none; }
        .nav-btn:hover { background: var(--matrix-color); color: var(--bg); box-shadow: 0 0 15px var(--matrix-color); }

        .search-box { margin: 20px auto; max-width: 90%; text-align: center; }
        #busca-input { width: 100%; max-width: 400px; padding: 10px; background: var(--bg); border: 1px solid var(--accent-color); color: var(--matrix-color); outline: none; border-radius: 5px; }

        /* COOKIE BANNER (NOVO) */
        #cookie-banner {
            position: fixed; bottom: -200px; left: 0; width: 100%;
            background: rgba(10, 10, 10, 0.95); border-top: 2px solid var(--accent-color);
            padding: 20px; text-align: center; z-index: 9999;
            transition: bottom 0.5s ease-in-out;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.8);
        }
        #cookie-banner.show { bottom: 0; }
        .btn-cookie { padding: 10px 20px; border: none; font-weight: bold; cursor: pointer; margin: 0 5px; text-transform: uppercase; }
        .btn-accept { background: var(--matrix-color); color: #000; }
        .btn-reject { background: transparent; border: 1px solid #555; color: #888; }

        /* COMENT√ÅRIOS 2.0 (VISUAL F√ìRUM) */
        .comment-box { 
            background: rgba(255,255,255,0.03); 
            border-left: 3px solid var(--matrix-color); 
            padding: 15px; 
            margin-bottom: 15px; 
            display: flex; gap: 15px;
            align-items: flex-start;
        }
        .avatar-circle {
            width: 40px; height: 40px;
            background: var(--accent-color);
            color: #000;
            font-weight: bold;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
            box-shadow: 0 0 10px var(--accent-color);
        }
        .comment-content { flex: 1; }
        .comment-user { display: block; font-weight: bold; color: var(--matrix-color); margin-bottom: 5px; font-size: 0.9rem; }
        .comment-date { color: #666; font-size: 0.75rem; margin-left: 10px; font-weight: normal; }
        .comment-text { color: #ccc; line-height: 1.4; font-size: 0.9rem; }

        /* WIDGETS & GRID */
        #scanner-widget { margin-bottom: 40px; background: rgba(255, 255, 255, 0.02); border: 1px solid var(--matrix-color); padding: 20px; border-radius: 8px; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: space-between; gap: 20px; transition: 0.3s; }
        #scanner-widget::before { content: ""; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, var(--matrix-color), transparent); opacity: 0.1; animation: scanLine 3s infinite linear; pointer-events: none; }
        @keyframes scanLine { 0% { left: -100%; } 100% { left: 200%; } }
        .scan-warning { flex: 1; text-align: left; font-size: 0.8rem; color: #888; border-left: 3px solid var(--accent-color); padding-left: 15px; }
        .scan-action-area { flex: 1; text-align: center; }
        .btn-scan { background: var(--matrix-color); color: #000; border: none; padding: 10px 25px; font-weight: bold; cursor: pointer; text-transform: uppercase; }

        @media (max-width: 600px) { #scanner-widget { flex-direction: column-reverse; text-align: center; } .scan-warning { border-left: none; border-top: 1px solid #333; padding-top: 10px; text-align: center; } }

        .container { padding: 20px; max-width: 800px; margin: 0 auto; min-height: 60vh; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .card { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; transition: 0.3s; position: relative; display: flex; flex-direction: column; }
        .card:hover { border-color: var(--matrix-color); transform: translateY(-5px); box-shadow: 0 0 15px var(--matrix-color); }
        .card-img { width: 100%; height: 160px; object-fit: cover; border-bottom: 1px solid var(--border); display: block; background: #222; }
        .card-body { padding: 15px; }
        .card h2 { color: var(--text); font-size: 1.2rem; margin: 5px 0; }
        .card span { font-size: 0.8rem; color: var(--accent-color); display: block; margin-bottom: 5px; }
        .btn-like { background: none; border: 1px solid var(--border); color: #888; cursor: pointer; padding: 5px 12px; border-radius: 20px; }
        .btn-like:hover { border-color: var(--accent-color); color: var(--accent-color); }

        /* OVERLAYS */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); overflow-y: auto; z-index: 200; padding: 20px; box-sizing: border-box; }
        .btn-voltar { background: transparent; border: 1px solid var(--matrix-color); color: var(--matrix-color); padding: 10px 20px; font-weight: bold; cursor: pointer; margin-bottom: 20px; }
        .overlay-content { max-width: 800px; margin: 0 auto; }
        .overlay-content img { max-width: 100%; border-radius: 5px; border: 1px solid var(--accent-color); }
        .overlay-content p { line-height: 1.6; margin-bottom: 15px; }
        pre[class*="language-"] { border: 1px solid var(--matrix-color) !important; border-radius: 8px !important; background: #111 !important; margin-bottom: 20px !important; }

        /* SECRET TERMINAL */
        #secret-terminal { display: block; position: fixed; top: 0; left: 0; width: 100%; height: 40vh; background: rgba(5,5,5,0.98); border-bottom: 2px solid var(--matrix-color); z-index: 9999; padding: 20px; box-sizing: border-box; overflow-y: auto; transform: translateY(-150%); transition: transform 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.8); font-size: 0.9rem; }
        #secret-terminal.open { transform: translateY(0); }

        /* HELP BOX */
        .help-box { border: 1px dashed var(--matrix-color); padding: 15px; margin-bottom: 20px; background: rgba(0,0,0,0.3); font-family: monospace; }
        .help-cmd { color: var(--accent-color); font-weight: bold; }

        .btn-pix { position: fixed; bottom: 20px; right: 20px; background: var(--accent-color); color: #fff; padding: 15px 25px; border-radius: 50px; font-weight: bold; box-shadow: 0 0 20px var(--accent-color); border: none; z-index: 50; animation: pulsando 2s infinite; }
        @keyframes pulsando { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        #contato-form input, #contato-form textarea { width: 100%; background: #050505; border: 1px solid var(--matrix-color); color: var(--matrix-color); padding: 10px; margin-bottom: 10px; font-family: monospace; }
        footer { text-align: center; padding: 40px; border-top: 1px solid var(--matrix-color); background: var(--panel); margin-top: 50px; }
    </style>
</head>
<body>

    <canvas id="matrix"></canvas>

    <div id="cookie-banner">
        <p style="color:var(--text); margin-bottom:15px;">
            <strong style="color:var(--matrix-color)">[ SISTEMA ]</strong> Este site utiliza cookies para salvar suas prefer√™ncias de tema e sess√£o.
        </p>
        <button class="btn-cookie btn-accept" onclick="aceitarCookies()">[ ACEITAR DADOS ]</button>
        <button class="btn-cookie btn-reject" onclick="recusarCookies()">[ RECUSAR ]</button>
    </div>

    <div id="secret-terminal">
        <div id="terminal-output" style="color:#aaa; margin-bottom:10px;">
            LINUX LAB KERNEL [v12.0]<br>Type <span style="color:var(--accent-color)">'help'</span> for command list.<br>System ready.<br>
        </div>
        <div style="display:flex;">
            <span style="color:var(--matrix-color); margin-right:10px;">root@linuxlab:~#</span>
            <input type="text" id="terminal-input" style="background:transparent; border:none; color:#fff; width:100%; outline:none; font-family:'Courier New', monospace;" autocomplete="off">
        </div>
    </div>

    <div id="home-view">
        <header>
            <button id="btn-terminal" onclick="window.toggleTerminal()">>_</button>
            <h1>Linux_Lab_</h1>
            <div id="relogio">00:00:00</div>
            <div id="terminal-typing" style="color:var(--accent-color); font-size:0.9rem; margin: 10px 0; min-height: 20px;">> _</div>

            <div class="nav-bar">
                <button class="nav-btn" onclick="window.ciclarTema()" id="btn-tema">[ üé® COR: VERDE ]</button>
                <button class="nav-btn" onclick="window.abrirTutorial()">[ ‚ùì MANUAL ]</button>
                <button class="nav-btn" onclick="window.abrirSobre()">[ üíæ SOBRE ]</button>
                <button class="nav-btn" onclick="window.abrirContato()">[ ‚úâÔ∏è CONTATO ]</button>
            </div>

            <div class="search-box"><input type="text" id="busca-input" placeholder="Buscar no sistema..." onkeyup="window.filtrarPosts()"></div>
        </header>

        <div class="container">
            <div id="scanner-widget">
                <div class="scan-warning">
                    <strong style="color:var(--accent-color)">[ ! ] SIMULATION MODE</strong><br>
                    <span style="font-size:0.75rem;">Este √© um ambiente seguro.<br>Seu IP n√£o est√° sendo exposto publicamente.</span>
                </div>
                <div class="scan-action-area">
                    <div id="scan-result">[STATUS] Aguardando comando...</div>
                    <button class="btn-scan" onclick="scanNetwork()">[ INICIAR SCAN ]</button>
                </div>
            </div>

            <div id="loading" style="text-align:center; color:var(--accent-color); margin-top:20px;">Carregando sistema...</div>
            <div class="grid" id="grid-posts"></div>
        </div>

        <footer>
            <p style="font-weight: bold;">LINUX_LAB_ // SYSTEM.ROOT</p>
            <div class="social-links"><a href="https://x.com/DaniloGardiano" target="_blank" style="color:var(--accent-color); text-decoration:none; font-weight:bold;">TWITTER</a></div>
            <p class="copyright">Developed by <strong>Danilo</strong> ¬© 2026</p>
        </footer>
    </div>

    <button class="btn-pix" onclick="window.fazerPix()">üí∏ Apoiar</button>

    <div id="leitura-overlay" class="overlay">
        <button class="btn-voltar" onclick="history.back()">< VOLTAR</button>
        <div class="overlay-content">
            <div id="conteudo-post"></div>
            <div id="comentarios-section" style="margin-top:40px; border-top:1px dashed var(--border); padding-top:20px;">
                <h3 style="color:var(--accent-color)">// COMMS_LOG (Discuss√£o)</h3>
                
                <div class="comment-form" style="background:#111; padding:15px; border-radius:5px; border:1px solid #333;">
                    <input type="text" id="coment-nome" placeholder="Codename (Seu Nome)" style="width:100%; background:#000; border:1px solid #333; color:var(--matrix-color); padding:10px; margin-bottom:5px;">
                    <textarea id="coment-texto" rows="3" placeholder="Digite sua mensagem aqui..." style="width:100%; background:#000; border:1px solid #333; color:#ccc; padding:10px;"></textarea>
                    <button class="btn-comment" onclick="window.enviarComentario()" style="background:var(--matrix-color); color:#000; border:none; padding:8px 20px; font-weight:bold; cursor:pointer; margin-top:5px;">[ ENVIAR DADOS ]</button>
                </div>
                
                <div id="lista-comentarios" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <div id="contato-overlay" class="overlay">
        <button class="btn-voltar" onclick="history.back()">< FECHAR</button>
        <div class="overlay-content" style="max-width: 600px;">
            <h2 style="color:var(--accent-color)">// SECURE_INBOX</h2>
            <div id="contato-form">
                <label>IDENTIDADE (Nome):</label> <input type="text" id="ct-nome">
                <label>CONTATO (Email/Twitter):</label> <input type="text" id="ct-contato">
                <label>PAYLOAD (Mensagem):</label> <textarea id="ct-msg" rows="5"></textarea>
                <button class="btn-comment" onclick="window.enviarContato()" style="width:100%; background:var(--matrix-color); color:#000; border:none; padding:10px;">[ EXECUTAR ENVIO ]</button>
            </div>
        </div>
    </div>

    <div id="sobre-overlay" class="overlay">
        <button class="btn-voltar" onclick="history.back()">< VOLTAR</button>
        <div class="overlay-content" style="max-width: 800px; margin: 0 auto;">
            <h2 style="color:var(--matrix-color)">// SYSTEM_INFO</h2>
            <p>Bem-vindo ao <strong>Linux Lab</strong>.</p>
            <p>Admin: <strong style="color:var(--accent-color)">Danilo Gardiano</strong></p>
        </div>
    </div>

    <div id="tutorial-overlay" class="overlay">
        <button class="btn-voltar" onclick="window.iniciarSessao()">< FECHAR</button>
        <div class="overlay-content">
            <h2 style="color:var(--matrix-color)">// SYSTEM_MANUAL_v3.0</h2>
            <p><strong>ACCESS LEVEL:</strong> GUEST</p>
            <hr style="border-color:#333; margin: 20px 0;">
            <div class="help-box">
                <div><span class="help-cmd">set-theme</span> Muda as cores.</div>
                <div><span class="help-cmd">matrix red/blue</span> Troca cor do terminal.</div>
            </div>
            <button class="btn-comment" onclick="window.iniciarSessao()" style="width:100%; background:var(--matrix-color); color:black; padding:15px; font-size:1.1rem; border:none; cursor:pointer;">[ INICIAR SESS√ÉO ]</button>
            <p style="text-align:center; font-size:0.8rem; color:#666; margin-top:10px;">*Clicar aqui salvar√° um cookie para n√£o exibir esta tela novamente.</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, onSnapshot, doc, updateDoc, increment, addDoc, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDnkmZ7BMasKQQGnAQSTi3jxiuCbxyLU7M", authDomain: "meubloglinux.firebaseapp.com", projectId: "meubloglinux", storageBucket: "meubloglinux.firebasestorage.app", messagingSenderId: "262696388382", appId: "1:262696388382:web:d2784dc5dbba922cc8eb0f" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        let listaArtigos = [];
        let currentPostId = null;

        // --- COOKIES & TUTORIAL MEMORY ---
        window.aceitarCookies = () => {
            localStorage.setItem('cookies_accepted', 'true');
            document.getElementById('cookie-banner').classList.remove('show');
        };
        window.recusarCookies = () => {
            document.getElementById('cookie-banner').classList.remove('show');
            // N√£o salvamos nada no localStorage se recusar (apenas fecha o aviso)
        };

        window.iniciarSessao = () => { 
            // Salva que o usu√°rio j√° viu o tutorial
            localStorage.setItem('vistoTutorial', 'sim'); 
            history.back();
            document.getElementById('tutorial-overlay').style.display = 'none';
            document.getElementById('home-view').style.display = 'block';
        };

        // Verifica na inicializa√ß√£o
        setTimeout(() => {
            // Check Cookies
            if(!localStorage.getItem('cookies_accepted')) {
                document.getElementById('cookie-banner').classList.add('show');
            }
            // Check Tutorial
            if (!localStorage.getItem('vistoTutorial')) { 
                window.abrirTutorial(); 
            } else {
                // Se j√° viu tutorial, garante que home est√° vis√≠vel
                document.getElementById('home-view').style.display = 'block';
            }
        }, 1000);

        // --- THEMES ---
        const themes = [
            { id: 'default', class: '', name: 'VERDE' },
            { id: 'cyber', class: 'theme-cyber', name: 'CYBER' },
            { id: 'frost', class: 'theme-frost', name: 'FROST' },
            { id: 'crimson', class: 'theme-crimson', name: 'CRIMSON' },
            { id: 'amethyst', class: 'theme-amethyst', name: 'AMETHYST' },
            { id: 'solar', class: 'theme-solar', name: 'SOLAR' }
        ];
        let currentThemeIndex = 0;

        window.ciclarTema = function() {
            document.body.classList.remove(...themes.map(t => t.class).filter(c => c));
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            aplicarTema(currentThemeIndex);
        };

        function aplicarTema(index) {
            currentThemeIndex = index;
            const t = themes[index];
            if(t.class) document.body.classList.add(t.class);
            document.getElementById('btn-tema').innerText = `[ üé® COR: ${t.name} ]`;
            if(localStorage.getItem('cookies_accepted') === 'true') {
                localStorage.setItem('linux_lab_theme_index', index);
            }
            const c = document.getElementById('matrix').getContext('2d');
            c.clearRect(0,0,window.innerWidth, window.innerHeight);
        }

        const savedTheme = localStorage.getItem('linux_lab_theme_index');
        if(savedTheme !== null) aplicarTema(parseInt(savedTheme));

        // --- TERMINAL ---
        window.toggleTerminal = () => { 
            const t = document.getElementById('secret-terminal'); 
            t.classList.toggle('open');
            if(t.classList.contains('open')) { setTimeout(() => document.getElementById('terminal-input').focus(), 300); }
        };
        document.addEventListener('keydown', (e) => { if(e.key==="'"||e.key==="`"){ e.preventDefault(); window.toggleTerminal(); } });
        
        const terminalInput = document.getElementById('terminal-input');
        terminalInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const rawCmd = this.value.trim().toLowerCase();
                const args = rawCmd.split(' ');
                const cmd = args[0];
                this.value = ''; 
                const corAtual = getComputedStyle(document.body).getPropertyValue('--matrix-color');
                const output = document.getElementById('terminal-output');
                output.innerHTML += `<div style="color:${corAtual}">root@linuxlab:~# ${rawCmd}</div>`;
                
                if(cmd === 'reboot') location.reload();
                else if(cmd === 'clear') output.innerHTML = '';
                else if(cmd === 'exit') window.toggleTerminal();
                else if(cmd === 'set-theme') {
                    const themeName = args[1];
                    const foundIndex = themes.findIndex(t => t.id === themeName);
                    if(foundIndex !== -1) {
                        document.body.classList.remove(...themes.map(t => t.class).filter(c => c));
                        aplicarTema(foundIndex);
                        output.innerHTML += `<div>Theme set to ${themeName}</div>`;
                    }
                }
                output.scrollTop = output.scrollHeight;
            }
        });

        // --- SCANNER ---
        window.scanNetwork = () => {
            const res = document.getElementById('scan-result');
            res.innerHTML = "Iniciando scan...<br>";
            setTimeout(() => res.innerHTML += "Detectando User Agent...<br>", 500);
            setTimeout(() => {
                fetch('https://api.ipify.org?format=json')
                .then(r => r.json())
                .then(data => res.innerHTML += `<br><strong style='color:#fff;'>IP P√öBLICO: ${data.ip}</strong>`)
                .catch(() => res.innerHTML += "Erro.");
            }, 1500);
        }

        // --- NAV & POSTS ---
        window.abrirSobre = () => abrirOverlay('sobre-overlay', '#sobre');
        window.abrirTutorial = () => abrirOverlay('tutorial-overlay', '#ajuda');
        window.abrirContato = () => abrirOverlay('contato-overlay', '#contato');
        
        function abrirOverlay(id, hash) { document.querySelectorAll('.overlay').forEach(el => el.style.display = 'none'); document.getElementById('home-view').style.display = 'none'; document.getElementById(id).style.display = 'block'; window.scrollTo(0,0); history.pushState({page: id}, null, hash); }
        window.addEventListener('popstate', () => { document.querySelectorAll('.overlay').forEach(el => el.style.display = 'none'); document.getElementById('home-view').style.display = 'block'; });

        window.fazerPix = () => { navigator.clipboard.writeText("pixlinuxblog@gmail.com").then(() => { confetti({particleCount:150}); alert("‚úÖ PIX copiado!"); }); };

        window.filtrarPosts = () => {
            const termo = document.getElementById('busca-input').value.toLowerCase();
            renderizar(listaArtigos.filter(p => p.titulo.toLowerCase().includes(termo)));
        };

        window.curtirPost = async (event, id) => { 
            event.stopPropagation(); 
            await updateDoc(doc(db, "artigos", id), { likes: increment(1) }); 
            confetti({ particleCount: 50, spread: 60, origin: { x: event.clientX/window.innerWidth, y: event.clientY/window.innerHeight } }); 
        };

        window.abrirPost = function(id) {
            currentPostId = id;
            const post = listaArtigos.find(p => p.id === id);
            if (post) {
                let html = post.conteudo || '<p>...</p>';
                if (post.imagem) html = `<img src="${post.imagem}" style="width:100%; border-radius:10px; margin-bottom:20px;">` + html;
                if (!html.includes('<h2>')) html = `<h2>${post.titulo}</h2>` + html;
                document.getElementById('conteudo-post').innerHTML = html;
                setTimeout(() => Prism.highlightAll(), 100);
                
                const divComents = document.getElementById('lista-comentarios');
                divComents.innerHTML = '<p>Carregando logs...</p>';
                if(window.unsubscribeComentarios) window.unsubscribeComentarios();
                
                const q = query(collection(db, "artigos", id, "comentarios"), orderBy("data", "desc"));
                window.unsubscribeComentarios = onSnapshot(q, (snapshot) => {
                    divComents.innerHTML = '';
                    if(snapshot.empty) { divComents.innerHTML = '<p style="color:#666;">// Nenhum dado encontrado.</p>'; return; }
                    snapshot.forEach(doc => {
                        const c = doc.data();
                        const dataFormatada = new Date(c.data).toLocaleDateString();
                        // GERA AVATAR COM A PRIMEIRA LETRA
                        const inicial = c.nome ? c.nome.charAt(0).toUpperCase() : '?';
                        
                        divComents.innerHTML += `
                            <div class="comment-box">
                                <div class="avatar-circle">${inicial}</div>
                                <div class="comment-content">
                                    <span class="comment-user">${c.nome} <span class="comment-date">${dataFormatada}</span></span>
                                    <div class="comment-text">${c.texto}</div>
                                </div>
                            </div>`;
                    });
                });
                abrirOverlay('leitura-overlay', '#leitura');
            }
        };

        window.enviarComentario = async () => {
            const nome = document.getElementById('coment-nome').value || "An√¥nimo";
            const texto = document.getElementById('coment-texto').value;
            if(!texto) return alert("Erro: Mensagem vazia.");
            await addDoc(collection(db, "artigos", currentPostId, "comentarios"), { nome, texto, data: new Date().toISOString() });
            document.getElementById('coment-texto').value = '';
        };

        window.enviarContato = async () => {
            const nome = document.getElementById('ct-nome').value;
            const msg = document.getElementById('ct-msg').value;
            if(!nome || !msg) return alert("Dados incompletos.");
            await addDoc(collection(db, "inbox_contato"), { nome, mensagem: msg, data: new Date().toISOString() });
            alert("‚úÖ MENSAGEM ENVIADA.");
            history.back();
        };

        function renderizar(lista) {
            const grid = document.getElementById('grid-posts'); grid.innerHTML = '';
            [...lista].reverse().forEach(post => {
                let img = (post.imagem && post.imagem.trim() !== "") ? `<img src="${post.imagem}" class="card-img" onerror="this.style.display='none'">` : "";
                grid.innerHTML += `<div class="card" onclick="window.abrirPost('${post.id}')">${img}<div class="card-body"><span>// ${post.categoria || 'Geral'}</span><h2>${post.titulo}</h2><div class="like-area"><button class="btn-like" onclick="window.curtirPost(event, '${post.id}')">‚ù§Ô∏è ${post.likes || 0}</button></div></div></div>`;
            });
        }

        // BOOT ANIMATION
        const mensagens = [ "Iniciando Kernel v12.0...", "Carregando m√≥dulos...", "Verificando integridade...", "Sistema Online." ];
        async function digitarTerminal() {
            const elemento = document.getElementById('terminal-typing');
            for (let i = 0; i < mensagens.length; i++) {
                const frase = mensagens[i];
                elemento.innerText = "> "; 
                for (let letra of frase) { elemento.innerText += letra; await new Promise(r => setTimeout(r, 40)); }
                await new Promise(r => setTimeout(r, 800));
            }
            elemento.innerHTML = "> Sistema Online <span class='cursor-blink'>_</span>";
        }
        digitarTerminal();

        // MATRIX
        const canvas = document.getElementById('matrix'), ctx = canvas.getContext('2d'); canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const drops = Array(Math.floor(canvas.width/14)).fill(1);
        setInterval(() => { 
            ctx.fillStyle='rgba(0,0,0,0.05)'; ctx.fillRect(0,0,canvas.width,canvas.height); 
            ctx.fillStyle=getComputedStyle(document.body).getPropertyValue('--matrix-color'); 
            ctx.font='14px monospace'; 
            drops.forEach((y,i)=>{ ctx.fillText("01LINUX"[Math.floor(Math.random()*7)], i*14, y*14); if(y*14>canvas.height && Math.random()>0.975) drops[i]=0; drops[i]++; }); 
        }, 50);

        setInterval(() => document.getElementById('relogio').innerText = new Date().toLocaleTimeString('pt-BR'), 1000);
        onSnapshot(query(collection(db, "artigos")), (snapshot) => { listaArtigos = []; snapshot.forEach((doc) => { let d = doc.data(); d.id = doc.id; listaArtigos.push(d); }); renderizar(listaArtigos); document.getElementById('loading').style.display = 'none'; });
    </script>
</body>
</html>